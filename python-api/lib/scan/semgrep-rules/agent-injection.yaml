rules:
  - id: tank/xml-tag-injection-in-markdown
    pattern-regex: "<(system|human|assistant|tool_use|function_calls|antml:)[^>]*>"
    message: "Claude XML control tag found in skill content - potential format injection"
    severity: ERROR
    paths:
      include: ["*.md", "*.txt", "*.yaml", "*.yml"]
    metadata:
      category: prompt-injection
      confidence: HIGH
      tags: [agent, injection, claude]

  - id: tank/dynamic-tool-loading
    patterns:
      - pattern-either:
          - pattern: json.loads($INPUT)
          - pattern: yaml.safe_load($INPUT)
      - metavariable-pattern:
          metavariable: $INPUT
          pattern-not: |
            open("...").read()
    message: "Tool definitions loaded from dynamic/untrusted input (potential tool poisoning)"
    severity: WARNING
    languages: [python]
    metadata:
      category: tool-poisoning
      confidence: MEDIUM
      tags: [agent, tool-poisoning]

  - id: tank/prompt-injection-ignore
    pattern-regex: "(?i)(ignore|disregard|forget)\\s+(all|any|previous|prior|above)\\s+(instructions?|prompts?|rules?)"
    message: "Prompt injection pattern - instruction override attempt"
    severity: ERROR
    paths:
      include: ["*.md", "*.txt", "*.py", "*.js", "*.ts"]
    metadata:
      category: prompt-injection
      confidence: HIGH
      tags: [agent, injection]

  - id: tank/role-hijacking
    pattern-regex: "(?i)(you are now|act as|pretend to be|role.?play as)\\s+(a|an|my)"
    message: "Role hijacking attempt detected"
    severity: ERROR
    paths:
      include: ["*.md", "*.txt"]
    metadata:
      category: prompt-injection
      confidence: MEDIUM
      tags: [agent, injection, role-hijacking]

  - id: tank/system-prompt-exfiltration
    pattern-regex: "(?i)(output|print|display|show|reveal|repeat)\\s+(the|your|all)\\s*(system\\s+prompt|instructions?|context)"
    message: "Attempt to exfiltrate system prompt or instructions"
    severity: ERROR
    paths:
      include: ["*.md", "*.txt", "*.py", "*.js", "*.ts"]
    metadata:
      category: prompt-injection
      confidence: HIGH
      tags: [agent, injection, exfiltration]
